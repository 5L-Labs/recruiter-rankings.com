<h1><%= t('reviews.new.title_for', name: @recruiter.name) %></h1>

<%= form_with url: reviews_path, scope: :review do |f| %>
  <%= f.hidden_field :recruiter_slug, value: @recruiter.public_slug %>

  <div>
    <%= f.label :overall_score, t('reviews.new.overall_score') %> <span style="color:#ef4444" aria-hidden="true">*</span><br>
    <%= f.number_field :overall_score, in: 1..5, step: 1, required: true, autofocus: true, aria: { describedby: 'score-help' } %>
    <small id="score-help" class="muted" style="display:block; margin-top:4px;"><%= t('reviews.new.overall_score_help') %></small>
  </div>

  <div>
    <%= f.label :text, t('reviews.new.your_experience') %> <span style="color:#ef4444" aria-hidden="true">*</span><br>
    <%= f.text_area :text, rows: 6, required: true, maxlength: 5000, placeholder: t('reviews.new.your_experience_placeholder'), aria: { describedby: 'text-help char-count' }, id: 'review_text' %>
    <div style="display:flex; justify-content:space-between; align-items:flex-start;">
      <small id="text-help" class="muted" style="margin-top:4px;"><%= t('reviews.new.text_help') %></small>
      <small id="char-count" class="muted" style="margin-top:4px;"><%= f.object.text.to_s.length %>/5000</small>
    </div>
  </div>

  <script nonce="<%= content_security_policy_nonce %>">
    document.addEventListener('DOMContentLoaded', function() {
      var text = document.getElementById('review_text');
      var count = document.getElementById('char-count');
      if (text && count) {
        function update() { count.textContent = text.value.length + '/5000'; }
        text.addEventListener('input', update);
        update();
      }
    });
  </script>

  <div>
    <%= f.label :email, t('reviews.new.email_optional') %><br>
    <%= f.email_field :email %>
  </div>

  <div style="margin-top:10px;">
    <%= f.submit t('reviews.new.submit'), class: 'cta' %>
  </div>
<% end %>

