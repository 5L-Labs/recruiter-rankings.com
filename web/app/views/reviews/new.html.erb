<h1><%= t('reviews.new.title_for', name: @recruiter.name) %></h1>

<%= form_with url: reviews_path, scope: :review do |f| %>
  <%= f.hidden_field :recruiter_slug, value: @recruiter.public_slug %>

  <div>
    <%= f.label :overall_score, t('reviews.new.overall_score') %> <span style="color:#ef4444" aria-hidden="true">*</span><br>
    <%= f.number_field :overall_score, in: 1..5, step: 1, required: true, autofocus: true, aria: { describedby: 'score-help' } %>
    <small id="score-help" class="muted" style="display:block; margin-top:4px;"><%= t('reviews.new.overall_score_help') %></small>
  </div>

  <div>
    <%= f.label :text, t('reviews.new.your_experience') %> <span style="color:#ef4444" aria-hidden="true">*</span><br>
    <%= f.text_area :text, rows: 6, required: true, maxlength: 5000, placeholder: t('reviews.new.your_experience_placeholder'), aria: { describedby: 'text-help text-counter' } %>
    <div style="display:flex; justify-content:space-between; margin-top:4px;">
      <small id="text-help" class="muted"><%= t('reviews.new.text_help') %></small>
      <small id="text-counter" class="muted">0/5000</small>
    </div>
  </div>

  <div>
    <%= f.label :email, t('reviews.new.email_optional') %><br>
    <%= f.email_field :email %>
  </div>

  <div style="margin-top:10px;">
    <%= f.submit t('reviews.new.submit'), class: 'cta' %>
  </div>
<% end %>

<script>
  (function() {
    function init() {
      var area = document.getElementById('review_text');
      var counter = document.getElementById('text-counter');
      if (!area || !counter) return;

      // Avoid double binding
      if (area.dataset.counterInitialized) return;
      area.dataset.counterInitialized = 'true';

      var max = area.maxLength > 0 ? area.maxLength : 5000;

      function update() {
        counter.textContent = area.value.length + '/' + max;
      }

      area.addEventListener('input', update);
      // Initial update in case of pre-filled value
      update();
    }

    document.addEventListener('turbo:load', init);
    document.addEventListener('DOMContentLoaded', init);
  })();
</script>
